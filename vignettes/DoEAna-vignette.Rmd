---
title: "DoEAna-vignette"
output: rmarkdown::html_vignette
description: >
  Start here if this is your first time using DoEAna. You'll learn why we made 
  this package and all the analysis functions in it. 
vignette: >
  %\VignetteIndexEntry{DoEAna-vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
# https://r-pkgs.org/vignettes.html
library(DoEAna)
```

## Optimal Design of Experiments

It's a relatively new field of statistics—in 1935, Ronald Fisher published The Design of Experiments, establishing classical designs for various types of experiments. With the rise of computing power came optimal design, where statisticians are able better customize designs according to the needs of the researchers running the experiment. Now, designs can be generated based on various criterion and metrics instead of simply selecting a design from a catalog. The purpose of this package is to fast-track comparison of optimal space-filling designs generated by the Maxmin criterion, which is very helpful in undergraduate research. 

## Space-filling designs

Space-filling designs are an alternative to the various alphabet criterion designs (A, D, I, G, etc). Instead of trying to minimize the prediction variance or have the most accurate parameter coefficients, space-filling designs seek to optimally “fill” the design space. We focused on two design spaces: the hypercube and the standard k-simplex. The hypercube is commonly used for process variables, such as time and temperature. The ‘hyper-’ prefix signifies that this is a cube extended into k dimensions (k being the number of variables being tested. The simplex is used for mixture experiments, where each factor is a percentage in the mixture, such as water, sugar and salt. For the data included in this package, we used Maxmin designs. maximize the minimum distance between experimental points in the design (like packing the number of spheres into a box). 

One of the most powerful aspects of space-filling designs is how they are capable of supporting higher-order models.  Most classical designs are only capable of supporting second-order models, whereas space-filling designs are capable of supporting fourth-order models. 

## The DoEAna package 
This package contains functions to compute various analysis on different designs. 

This includes:

* printing the raw design matrix with `print_design()`
* plotting the design on the hypercube or simplex with `plot_design()`
* viewing the relative efficiencies of three designs with `relative_efficiency()`
* making a Fraction of Design Space plot for two designs with `fds_plot()`

The print_design() displays the design matrix of each optimal design. For a practitioner looking to run an experiment, this gives them the design’s factor levels (on a -1 to 1 standardized scale) for each experimental run. Thus, printing out the design is key for running an experiment. 

On the other hand, plotting a design gives the user a sense of where various experimental runs are on a standardized scale. This serves as a ‘check’ to ensure that the design is indeed space-filling and enables us to visually compare the designs generated by the differing distance metrics. 

Relative efficiency compares design performance. First, we score an optimal design on the criteria of the competing design. Then, take the ratio of those scores and multiply by 100 to get a percentage. Values greater than 100 indicate the competing design is more efficient while a score less than 100 indicates the design is less efficient on the criterion it is compared to. For example, if we have two optimal designs such that one was generated using the Manhattan distance criteria and the other was generated using the Chebychev distance criteria, we could check the relative efficiency of the Chebychev optimal design by scoring it on the Manhattan criteria and calculating the relative efficiency.

 The fraction of design space plot evaluates relative predictive variance across the design space. It does so by generating random design points across the space for the two competing designs and calculating the relative prediction variance at those points. The function then arranges these prediction variances as a cumulative distribution function so that we see how prediction variance changes across the design space. One would use such a plot by choosing the design that has a lower relative predictive variance for the largest proportion  of the design space. 


## The sf_designs data set
The internal dataset in DoEAna is `sf_designs`. It is A collection of optimal Maxmin space-filling designs on the hypercube and simplex for n = 10, 20, 30 experimental runs. There are k = 2 experimental factors for the hypercube k = 3 for the simplex. These were found with three different distance metrics: Manhattan, Euclidean, and Chebyshev. This dataset was generated by Rebekah Scott's undergraduate research with Dr. Stephen Walsh at Utah State University. 

## First, select and plot a design
If you're using the sf_designs data, decide which geometry, distance metric and number of experimental runs you want. After you select a design, you can print the design matrix and plot it.

```{r}
# for the hypercube 
my_design_hyper <- select_design(d_data = sf_designs, geometry = "hypercube", distance = "chebyshev", n = 30)
print_design(my_design_hyper)
plot_design(my_design_hyper)
```

## Next, compute relative efficencies 

Relative Efficiency is the easiest way of comparing designs generated for different criterion. To do this, we compute the minimum distance score on each of the designs with all three criterions, divide by the optimal score on the criterion, and then put it all in a table. With DoEAna, you are able to compute the relative efficency table for designs created with the manhattan, euclidean, and chebyshev distance metrics.  

Here's an example across the same number of experimental runs: 

```{r}
# first select the designs 
# for this, we're doing n = 20 across the hypercube!
my_designM_H <- select_design(d_data = sf_designs, geometry = "hypercube",
                            distance = "manhattan", n = 20)
my_designE_H <- select_design(d_data = sf_designs, geometry = "hypercube",
                            distance = "euclidean", n = 20)
my_designC_H <- select_design(d_data = sf_designs, geometry = "hypercube",
                            distance = "chebyshev", n = 20)

relative_efficiency(m_row = my_designM_H, e_row = my_designE_H, 
                    c_row = my_designC_H)
```

## Finally, create an FDS plot
Fraction of Design Space Plots were created by Dr. Alyaa Abdelaziz. This analysis tool enables us to compare the relative prediction variance across the design space for two (or more) designs. With DoEAna, we're able to create FDS plots for two designs, as shown below.

```{r}
fds_plot(design1 = my_designC_H, design2 = my_designM_H, 
         title = "Chebychev vs Manahattan Distance for n=20")
```

## Conclusion 

DoEAna has several valuable uses and take-aways. First, it speeds up analysis while doing Design of Experiments research. It’s very applicable in food science, chemistry, and other fields where mixture experiments on the simplex — where the factors add up to 100% of a mixture — are common. It also contains reproducible research so users can analyze the various designs with a few simple commands. The initial question of this research was, “Does changing the distance metric affect the resulting optimal design?” After analysis, we concluded that changing the distance metric doesn't have a huge effect on the resulting space-filling design (ie Maxmin designs are robust to the distance metric). This package can also be used as an intro to optimal design of experiments with an easy-to-understand criterion, visuals, and simple comparison methods. 
Thank you for joining us for a \bf{D}esign of \bf{E}xperiments \bf{Ana}lysis. 

